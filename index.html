<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Game Canvas</title>
</head>
<body style="background-color: #FEFEFE;">
  <center>
    <canvas id="game" style="background-color: #FEFEFE">Canvas not work!</canvas>
  </center>
  <script>
    var game = document.getElementById("game"); 
    var wall = game.getContext("2d");
    
    var posX, posY;
    
    var map = [
      [1,1,1,1,1,1,1,1,1,1],
      [1,3,2,2,2,2,2,2,2,1],
      [1,1,1,1,1,1,1,1,2,1],
      [1,2,2,2,1,2,2,2,2,1],
      [1,2,1,2,1,2,1,1,1,1],
      [1,2,1,2,2,2,1,1,1,1],
      [1,2,1,1,1,1,1,1,1,1],
      [1,2,2,2,2,1,1,1,1,1],
      [1,1,1,1,2,2,2,2,2,1],
      [1,1,1,1,1,1,1,1,4,1]
    ];
    
    game.width = 320;//10
    game.height = 320;//10
    
    //wall.fillStyle = "#85ABC6";
    
    //wall.fillRect(i*32, j*32 , 32, 32);    
    
    function drawGame() {
    for(var y = 0; y < 10; y++) {
      for(var x = 0; x < 10; x++) {
        if(map[y][x] == 1) {
          wall.fillStyle = "#85ABC6";//синий
          wall.fillRect(x*32, y*32 , 32, 32);      
        } else if(map[y][x] == 2) {
          wall.fillStyle = "#FEFEFE";//белий
          wall.fillRect(x*32, y*32 , 32, 32);  
        } else if(map[y][x] == 3) {
          posX = x;
          posY = y;
          wall.fillStyle = "#63E2AF";//зелений
          wall.fillRect(x*32, y*32 , 32, 32);      
        } else if(map[y][x] == 4) {
          wall.fillStyle = "#81E7BE";//зелений финиш
          wall.fillRect(x*32, y*32 , 32, 32);      
        }
      }
    }
    }
    drawGame();
     
    
document.addEventListener('touchstart', handleTouchStart, false);        
document.addEventListener('touchmove', handleTouchMove, false);

var xDown = null;                                                        
var yDown = null;                                                        

function handleTouchStart(evt) {                                         
    xDown = evt.touches[0].clientX;                                      
    yDown = evt.touches[0].clientY;                                      
};                                                

function handleTouchMove(evt) {
    if ( ! xDown || ! yDown ) {
        return;
    }

    var xUp = evt.touches[0].clientX;                                    
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
        if ( xDiff > 0 ) {
          //alert("left");
          if(map[posY][posX-1] == 2) {
            //alert("yes");

            wall.fillStyle = "#FEFEFE";//белий
            wall.fillRect(posX*32, posY*32 , 32, 32); 

            wall.fillStyle = "#63E2AF";//зелений
            wall.fillRect((posX-1)*32, posY*32 , 32, 32);

            map[posY][posX] = 2;
            map[posY][posX-1] = 3;
            posX = posX-1;

          } else if(map[posY][posX-1] == 4) {
            alert("You win!");  
          }
        } else {
            //alert("right");
          if(map[posY][posX+1] == 2) {
          //alert("yes");
          
          wall.fillStyle = "#FEFEFE";//белий
          wall.fillRect(posX*32, posY*32 , 32, 32); 
          
          wall.fillStyle = "#63E2AF";//зелений
          wall.fillRect((posX+1)*32, posY*32 , 32, 32);
          
          map[posY][posX] = 2;
          map[posY][posX+1] = 3;
          posX = posX+1;
          
        } else if(map[posY][posX+1] == 4) {
          //alert("You win!");  
        }
        }                       
    } else {
        if ( yDiff > 0 ) {
            //alert("up");
          if(map[posY-1][posX] == 2) {
          //alert("yes");
          
          wall.fillStyle = "#FEFEFE";//белий
          wall.fillRect(posX*32, posY*32 , 32, 32); 
          
          wall.fillStyle = "#63E2AF";//зелений
          wall.fillRect((posX)*32, (posY-1)*32 , 32, 32);
          
          map[posY][posX] = 2;
          map[posY-1][posX] = 3;
          posY = posY-1;
          
        } else if(map[posY-1][posX] == 4) {
          alert("You win!");  
        }
          
        } else { 
           // alert("down");
          if(map[posY+1][posX] == 2) {
          //alert("yes");
          
          wall.fillStyle = "#FEFEFE";//белий
          wall.fillRect(posX*32, posY*32 , 32, 32); 
          
          wall.fillStyle = "#63E2AF";//зелений
          wall.fillRect((posX)*32, (posY+1)*32 , 32, 32);
          
          map[posY][posX] = 2;
          map[posY+1][posX] = 3;
          posY = posY+1;
          
        } else if(map[posY+1][posX] == 4) {
          alert("You win!");  
        }
        }                                                                 
    }
    /* reset values */
    xDown = null;
    yDown = null;                                             
};    
    

  </script>
</body>
</html>